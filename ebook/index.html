<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Hello!</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="viewport" content="width=device-width user-scalable=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />


    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>

  </head>

  <style>
    @media screen and (min-width: 320px) and (max-width: 767px) and (orientation: portrait) {
      html {
        transform: rotate(-90deg);
        transform-origin: left top;
        width: 100vh;
        overflow-x: hidden;
        position: absolute;
        top: 100%;
        left: 0;
      }
    }
    /* from https://css-tricks.com/snippets/css/orientation-lock/ */

    body {
      margin: 0px;
      padding: 0px;
    }

    #slidescontainer {
      width: 100%;
      height: 100%;
      position: relative;
    }

    #swiperwrapper {
      width: 100%;
      height: 100%;
      position: flex;
    }

    .slide {
      width: 100vw;
      height: 100vh;
      background-position: center;
      background-size: cover;
    }

    #slidebackground{
      /*transition: background 1s linear;*/
    }

    @media (min-width: 1000px) {
    #slidetext{
      max-width:1000px;
       position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }    
    }
    
    @media (max-width: 900px) {
    #slidetext{
      max-width:100%;
    }
    }

    #right {
      position: fixed;
      right: 0px;
      height: 100vh;
      width: 70vw;
      z-index: 5;
    }

    #left {
      position: fixed;
      left: 0px;
      height: 100vh;
      width: 30vw;
      z-index: 5;
    }

    #slidetext {
      max-width: 90%;
    }
  </style>

  <body>

    <div id="left"></div>
    <div id="right"></div>


    <div id="slidescontainer">

        <div id="intro">
            <p>Please <a href="#" onclick="openFullscreen()">go fullscreen</a></p>
            <p>Please rotate your device.</p>
            <p id="loading">Images loading...</p>
        </div>

      <div id="sliderwrapper">
        <div class="slide" id="slidebackground">
          <img id="slidetext" />
        </div>
      </div>
    </div>

    <script>

    var elem = document.documentElement;

    /* View in fullscreen */
    function openFullscreen() {
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.mozRequestFullScreen) { /* Firefox */
        elem.mozRequestFullScreen();
      } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { /* IE/Edge */
        elem.msRequestFullscreen();
      }
    }      
      var slidecount;
      var slidecount = -1;

    var data = {
    "slides": [
      {
        "spread": "images/Title-Page-Ebook.png"
      },        
      {
        "textbackground": "images/Journey-Shooting-Star-Ebook-IMAGE-TXT-1-CNTR.png",
        "textimage": "images/Journey-Shooting-Star-Ebook-TEXT-1-CNTR.png"
      },
      {
        "textbackground": "images/Journey-Shooting-Star-Ebook-IMAGE-TXT-2-CNTR.png",
        "textimage": "images/Journey-Shooting-Star-Ebook-TEXT-2-CNTR.png"
      },
      {
        "spread": "images/Journey-Shooting-Star-Ebook-TOP.png"
      },      
      {
        "textbackground": "images/Rocket-Ebook-IMAGE-BTM.png",
        "textimage": "images/Rocket-Ebook-TXT.png"
      },
      {
        "spread": "images/Rocket-Ebook.png"
      },      
      {
        "textbackground": "images/Lightning-Ebook-IMAGE-TXT.png",
        "textimage": "images/Lightning-Ebook-TXT.png"
      },
      {
        "spread": "images/Lightning-Ebook.png"
      },
      {
        "textbackground": "images/Balloons-Ebook-IMAGE-TXT-CNTR.png",
        "textimage": "images/Balloons-Ebook-TXT-CNTR.png"
      },
      {
        "spread": "images/Balloons-Ebook-BTM.png"
      },
      {
        "textbackground": "images/Desert-Surf-Ebook-IMAGE-TXT-TOP.png",
        "textimage": "images/Desert-Surf-Ebook-TXT.png"
      },
      {
        "spread": "images/Desert-Surf-Ebook-TOP.png"
      },
      {
        "textbackground": "images/Ski-Jump-Ebook-IMAGE-TXT-TOP.png",
        "textimage": "images/Ski-Jump-Ebook-TXT.png"
      },
      {
        "spread": "images/Ski-Jump-Ebook-CNTR.png"
      },
      {
        "textbackground": "images/Sea-Monster-Ebook-IMAGE-BTM.png",
        "textimage": "images/Sea-Monster-Ebook-TXT-BTM.png"
      },
      {
        "spread": "images/Sea-Monster-Ebook-TOP.png"
      },
      {
        "textbackground": "images/Great-Wall-Ebook-IMAGE-TXT-CNTR.png",
        "textimage": "images/Great-Wall-Ebook-TXT.png"
      },
      {
        "spread": "images/Great-Wall-Ebook-BTM.png"
      },
      {
        "textbackground": "images/Deep-Sea-Divers-Ebook-TXT-IMAGE-TOP.png",
        "textimage": "images/Deep-Sea-Divers-Ebook-TXT-TOP.png"
      },
      {
        "spread": "images/Deep-Sea-Divers-Ebook-TOP.png"
      },
      {
        "textbackground": "images/Camels-Ebook-IMAGE-TXT-CNTR.png",
        "textimage": "images/Camels-Ebook-TXT.png"
      },
      {
        "spread": "images/Camels-Ebook-TOP.png"
      },
      {
        "textbackground": "images/Northern-Lights-Ebook-IMAGE-TXT-BTM.png",
        "textimage": "images/Northern-Lights-Ebook-TXT.png"
      },
      {
        "spread": "images/Northern-Lights-Ebook-TOP.png"
      },
      {
        "textbackground": "images/Honeybeess-Ebook-IMAGE-TXT-CNTR.png",
        "textimage": "images/Honeybeess-Ebook-TXT-CNTR.png"
      },
      {
        "spread": "images/Honeybeess-Ebook-CNTR.png"
      },
      {
        "textbackground": "images/WIND-Ebook-TXT-IMAGE-CNTR.png",
        "textimage": "images/WIND-Ebook-TXT-CNTR.png"
      },
      {
        "spread": "images/WIND-Ebook-CNTR.png"
      },
      {
        "textbackground": "images/Steam-Train-Ebook-IMAGE-TXT-CNTR.png",
        "textimage": "images/Steam-Train-Ebook-TXT.png"
      },
      {
        "spread": "images/Steam-Train-Ebook-CNTR.png"
      },
      {
        "textbackground": "images/Night-Bedtime-Ebook-IMAGE-TXT-CNTR.png",
        "textimage": "images/Night-Bedtime-Ebook-TXT.png"
      },
      {
        "spread": "images/Night-Bedtime-Ebook-CNTR.png"
      },
      {
        "textbackground": "images/The-End-Ebook-IMAGE-TXT-CNTR.png",
        "textimage": "images/The-End-Ebook-TXT.png"
      },
      {
        "spread": "images/The-End-Ebook.png"
      },                                                                              
    ]
    };

    var slides = data.slides;

    $(document).keydown(function(e){
    if (e.which == 39) { // right key
      slidecount++;
      changeSlide(slidecount);
      return false;
    }
    });

    $("#right").click(function() {
      slidecount++;
      changeSlide(slidecount);
    });

    $(document).keydown(function(e){
    if (e.which == 37) { //left key
      slidecount--;
      changeSlide(slidecount);
      return false;
    }
    });

    $("#left").click(function() {
      slidecount--;      
      changeSlide(slidecount);
    });


function changeSlide(num){
  $(".slide" ).fadeOut( "fast", function() {
    $("#intro").hide();
    $("#slidetext").attr("src", "");
    var textbackground = slides[num].textbackground;
    var textimage = slides[num].textimage;
    var spread = slides[num].spread;
    if (spread) {
      $("#slidebackground").css("background-image", "url(" + spread + ")");
    }
    if (textbackground) {
      $("#slidebackground").css("background-image", "url(" + textbackground + ")");
      $("#slidetext").attr("src", textimage);
    }
    $(".slide" ).fadeIn( function() {
    // Animation complete.
    });
    });
  };

/**
 * Loader function that helps to trigger a callback when multiple images has been loaded. Besides
 * indicates which images were correctly/wrong loaded.
 * 
 * @param {Array} Images An array of strings with the paths to the images.
 * @param {Function} Callback Callback function executed when all images has been loaded or not.
 * From here: https://ourcodeworld.com/articles/read/571/how-to-verify-when-multiple-images-have-been-loaded-in-javascript
 */
 function ImageLoader(Images, Callback){
    // Keep the count of the verified images
    var allLoaded = 0;

    // The object that will be returned in the callback
    var _log = {
        success: [],
        error: []
    };

    // Executed everytime an img is successfully or wrong loaded
    var verifier = function(){
        allLoaded++;

        // triggers the end callback when all images has been tested
        if(allLoaded == Images.length){
            Callback.call(undefined, _log);
        }
    };

    // Loop through all the images URLs
    for (var index = 0; index < Images.length; index++) {
        // Prevent that index has the same value by wrapping it inside an anonymous fn
        (function(i){
            // Image path providen in the array e.g image.png
            var imgSource = Images[i];
            var img = new Image();
            
            img.addEventListener("load", function(){
                _log.success.push(imgSource);
                verifier();
            }, false); 
            
            img.addEventListener("error", function(){
                _log.error.push(imgSource);
                verifier();
            }, false); 
           
            img.src = imgSource;
        })(index);
    }
};

var bookimages = [];

for (slide in slides){
    var textbackground = slides[slide].textbackground;
    var textimage = slides[slide].textimage;
    var spread = slides[slide].spread;
    if (spread) {
      bookimages.push(spread);
    }
    if (textbackground) {
      bookimages.push(textbackground);
      bookimages.push(textimage);
    }
};

ImageLoader(bookimages, function(result){
    if(result.error){
        // outputs: ["example.png", "example.jpg"]
        console.log("The following images couldn't be properly loaded: ", result.error);
    }

    // outputs: ["http://i.imgur.com/fHyEMsl.jpg"]
    console.log("The following images were succesfully loaded: ", result.success);
    $("#loading").html("Images Loaded!");
});

    </script>
  </body>
</html>
